#! /bin/bash

source /usr/lib/naylib

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

draw_heading "Install packages"

draw_spinner "Updating mirror list" "sudo reflector --verbose --latest 10 --sort rate --save /etc/pacman.d/mirrorlist"

yay -Syu --sudoloop --noconfirm
pkill -RTMIN+3 dwmblocks

for pkg in `cat "$DIR/../packages" | sed -e '/^[ \t]*#/d' | sed '/^$/d'` ; do
  sudo -v
  if yay -Sqg "$pkg" &> /dev/null ; then
    for gpkg in `yay -Sqg "$pkg"` ; do
      yay -Q "$gpkg" &> /dev/null && continue
      uur native "$pkg"
    done
  else yay -Q "$pkg" &> /dev/null 
    uur native "$pkg"
  fi
done
